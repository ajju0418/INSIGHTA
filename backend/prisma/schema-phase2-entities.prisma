
model Habit {
  id                  String    @id @default(uuid())
  userId              String
  name                String
  icon                String?
  color               String?
  
  streak              Int       @default(0)
  longestStreak       Int       @default(0)
  totalCompletions    Int       @default(0)
  
  targetTime          String?   // HH:MM format
  reminderEnabled     Boolean   @default(false)
  
  isActive            Boolean   @default(true)
  isDeleted           Boolean   @default(false)
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  lastCompletedAt     DateTime?
  deletedAt           DateTime?
  
  // Relations
  user                User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  completions         HabitCompletion[]
  timelineEvents      TimelineEvent[]
  
  @@index([userId])
  @@index([userId, isDeleted])
  @@map("habits")
}

model HabitCompletion {
  id              String    @id @default(uuid())
  habitId         String
  userId          String
  
  completedAt     DateTime  @default(now())
  notes           String?
  mood            String?   // great, good, okay, bad
  
  // Relations
  habit           Habit     @relation(fields: [habitId], references: [id], onDelete: Cascade)
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([habitId, completedAt])
  @@index([userId, completedAt])
  @@map("habit_completions")
}

model Goal {
  id              String    @id @default(uuid())
  userId          String
  name            String
  type            String    // habit, budget, milestone
  
  target          Decimal   @db.Decimal(10, 2)
  current         Decimal   @default(0) @db.Decimal(10, 2)
  unit            String
  
  icon            String?
  color           String?
  deadline        String?
  deadlineDate    DateTime?
  
  isCompleted     Boolean   @default(false)
  isDeleted       Boolean   @default(false)
  
  completedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?
  
  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  timelineEvents  TimelineEvent[]
  
  @@index([userId])
  @@index([userId, isDeleted])
  @@map("goals")
}

model Expense {
  id              String    @id @default(uuid())
  userId          String
  
  amount          Decimal   @db.Decimal(10, 2)
  category        String    // food, transport, shopping, entertainment, coffee, other
  description     String?
  
  date            DateTime  @default(now())
  impact          String?   // positive, neutral, negative
  tags            String[]
  
  isDeleted       Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?
  
  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  timelineEvents  TimelineEvent[]
  
  @@index([userId, date])
  @@index([userId, category])
  @@index([userId, isDeleted])
  @@map("expenses")
}

model TimelineEvent {
  id              String    @id @default(uuid())
  userId          String
  
  eventType       String    // HABIT, EXPENSE, GOAL, CUSTOM
  eventName       String
  startTime       DateTime  @default(now())
  duration        Int?      // minutes
  
  // Polymorphic relations
  relatedHabitId  String?
  relatedExpenseId String?
  relatedGoalId   String?
  
  metadata        Json?
  
  createdAt       DateTime  @default(now())
  
  // Relations
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  habit           Habit?    @relation(fields: [relatedHabitId], references: [id], onDelete: SetNull)
  expense         Expense?  @relation(fields: [relatedExpenseId], references: [id], onDelete: SetNull)
  goal            Goal?     @relation(fields: [relatedGoalId], references: [id], onDelete: SetNull)
  
  @@index([userId, startTime])
  @@index([eventType])
  @@map("timeline_events")
}
